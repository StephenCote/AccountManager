<html-fragment>
	<import-xml src = "/AccountManagerExample/Forms/ParentPicker.xml" id = "ParentPicker" />

	<div class = "rocket-column-2" rid = "dataTypeContainer">
		<p>
			Type:
		</p>
		<p>
			<select rid = "roleType" disabled = "true" bind = "${bean.rocketType}">
				<option>ACCOUNT</option>
				<option selected = "true">USER</option>
			</select>
		</p>
	</div>
	
		<div class = "rocket-column-2">
		<p>
			Child Roles:
		</p>
		<p>
			<div component = "wideselect" rid = "rolesList">
			</div>

			<br />
			<input type = "button" class = "rocket-button" value = "+" onclick = "${this}.addChildRole()" />
			<input type = "button" class = "rocket-button" value = "-" onclick = "${this}.removeChildRole()" />
			<input type = "button" class = "rocket-button" value = ">" onclick = "${this}.openChildRole()" />
		</p>
	</div>
	
	<embedded-script><![CDATA[
		embedded_init : function(o){
			this.GetComponentByRID("rolesList").setLoadHandler(this.scopeHandler("configRolesList",0,1,1));
		},
		
		openChildRole : function(){
			var oI = this.getRolesList().getActiveItem();
			if(oI && oI.data && this.openItem) this.openItem(oI.data,"Role");
		},
		addChildRole : function(){
			this.manageList("Role", this.getRolesList().getObjectId());
		},
		removeChildRole : function(){
			var oI = this.getRolesList().getActiveItem();
			if(oI){
				this.getRolesList().clearItem(oI.index);
			}
		},
		configRolesList : function(s,v){
			var o = this.getBean("rocketType");
			var oL = this.getRolesList();
			oL.getContainer().style.height = "50px";
			oL.getContainer().style.width = "150px";
			this.refreshRoles();
		},
		refreshRoles : function(a){
			var oL = this.getRolesList();
			oL.clearItems();
			var o = this.getBean("rocketType");
			if(!o || o == null) return;
			var aL = accountManager.listRoles(o.organization,o);
			for(var i = 0; i < aL.length;i++){
				oL.addItem(aL[i].name + " " + aL[i].roleType,aL[i]);
			}
		},
		getRolesList : function(){
			return this.GetComponentByRID("rolesList").GetWideSelect();
		},
		embedded_destroy : function(){
		},
		
		addType : function(o){
			Hemi.log("Add role type: " + o.name + ":" + o.roleType);

			var v = "";
			if(o.mimeType && o.mimeType.match(/^text/)){
				v = this.GetElementByRID("textData").value;
				return accountManager.addData(o.name, o.description, o.mimeType, v, o.group);
			}
			else if(o.mimeType.match(/^binary$/)){
				var oF = this.get_frame("mediaUploadFrame");
				oF.document.forms["mediaForm"].elements["id"].value = "0";
				oF.document.forms["mediaForm"].elements["name"].value = o.name;
				oF.document.forms["mediaForm"].elements["description"].value = o.description;
				oF.document.forms["mediaForm"].elements["groupId"].value = o.group.id;
				oF.document.forms["mediaForm"].submit();
				return -1;
			}
		},
		
		prepareSave : function(o){

			return 1;
		}
	]]></embedded-script>
</html-fragment>